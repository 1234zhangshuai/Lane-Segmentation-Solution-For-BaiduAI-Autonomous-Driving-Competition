# Lane-Segmentation-Solution-For-Baidu-PaddlePaddle-Autonomous-Driving-Competition
Lane Segmentation Solution for Baidu AI PaddlePaddle Autonomous Driving Competition

用英文写太麻烦了，还是用母语吧。[无人车车道线检测挑战赛](http://aistudio.baidu.com/aistudio/#/competition/detail/5),为了这个比赛硬生生在四个月中初步了解了PaddlePaddle，并且能够学以致用，也算是收获颇多。

### 总体描述
本次比赛图像分辨率非常的大，3384x1710，对于我这个只拥有两块1070Ti的人来说，只好忍痛缩小图像。下面说下我的几个主要思路吧：

【1】经过对label的分析，我首先裁掉了图片最上部的3384x690的图像，因为这部分都是天空和树木，没有正样本的存在，裁掉后还可以减小图像的压缩比例，一举两得。

【2】裁掉后，为了尽可能保持图像比例，在比赛不同阶段我才用了3种分辨率（768x256,1024x384,1536x512）进行训练，并且大分辨率的模型是基于前一个小分辨率的预训练模型而来（这样做的原因是大分辨率由于感受野的问题，很难训练，所以先从小分辨率入手，不仅可以快速验证模型的有效性，还能够提供较好的特征与分布；事实证明，基于小分辨率的预训练，确实可以帮助大分辨率更好地进行收敛）。

【3】本次比赛我精简了paddle提供的deeplabv3p的模型，并且根据以往在kaggle的比赛经验，重新设计了两个基于resnet残差模块的unet网络，最终成绩了采用了三个网络的平均结果。

【4】在训练策略上，采用了修改版的Cycle LR策略（原本写了个全自动的，但是由于训练偶尔出现loss为NaN的情况，耽误了很多时间，所以只好改为手动了）。采用Adam，前3个epochs采用默认参数训练（lr=0.001），在之后3个epochs的训练中，每个epoch平均分配出6个改变lr的地方，改变方式为:0.001-0.0006-0.0003-0.0001-0.0004-0.0008-0.001。最后两个epoch一般采用0.0004-0.0001之间学习率训练的策略。由于测试集与训练集在图像质量和视觉感知上差距不小，太小的学习率很容易导致过拟合，所以我最小的学习率采用0.0001。在8-10个epochs后，训练基本上就结束了。

【5】在loss function的使用上，最先的三个epochs我采用sigmoid bce，后面的训练中采用bce + dice的方式，这种方式会比单一的bce提升0.01-0.015。

【6】数据清洗上，最一开始我采用了全部数据训练，发现loss经常出现不规则的跳动，经过排查，我发现road 3存在几乎一半以上图像过曝的问题，并且road 3大多在强光下拍摄，不符合测试集的分布，所以我很果断的舍弃了road 3，分数也提升了0.01左右（好神奇。。。）。

【7】数据增强上，由于第五类和第八类训练数据较少（但是测试集中占比不少），所以针对这两类，我采用了iaa的图像处理，从亮度、饱和度、噪点、对比度、crop、scale等方面做了共计12000张图片的增强。最后我排查了一遍road 2和road 4，把一些错误和过曝的图片都删掉了，最终保留了56000张图片（包括数据增强的图片）进行训练。
